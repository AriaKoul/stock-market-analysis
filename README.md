# Stock Market Analysis 
## Background
There are many articles in the financial press about how the stock market tends to rise overnight instead of during trading hours. Some of these articles are below:

[New York Times - "The Stock Market Works by Day, but It Loves the Night"](https://www.nytimes.com/2018/02/02/your-money/stock-market-after-hours-trading.html)

[Financial Times - "The curious case of rising stocks in the night-time"](https://www.ft.com/content/1cc17824-3077-4e39-9a99-cbccc83a2251)

[Bloomberg - "Unbeatable Overnight Gains Fuel Theories on Who’s Driving Them"](https://www.bloomberg.com/news/articles/2020-09-17/volatility-bout-puts-outsize-overnight-stock-moves-in-focus)

Below is a quote from the New York Times article:

>Separate the daytime and the after-hour returns and calculate them cumulatively, as Bespoke has done, and it turns out that **all of that price gain since 1993 has come outside regular trading hours**.
If you had bought the SPY at the last second of trading on each business day since 1993 and sold at the market open the next day — capturing all of the net after-hour gains — your cumulative price gain would be 571 percent.
On the other hand, if you had done the reverse, buying the E.T.F. at the first second of regular trading every morning at 9:30 a.m. and selling at the 4 p.m. close, you would be down 4.4 percent since 1993.

![This is an image from the New York Times article](https://i.imgur.com/5jIfi80.png)

Existing tools such as [Portfolio Visualizer](https://www.portfoliovisualizer.com/) are great but only accomodate the buy and hold strategy.

I set out to validate the conclusion from the articles and create a tool to allow for a comparison of all three of the following strategies: buy the open --> sell the close, buy the close --> sell the open, buy and hold. 
 

## How to Use
Clone this repository using the following code:

`$ git clone https://github.com/AriaKoul/stock-market-analysis`

Specify the ticker, start date, end date, and the portfolio starting amount in the file named `create_plot.py`

For example: 

`ticker = 'SPY'`

`start_date = '2021-01-01'`

`end_date = '2022-01-01'`

`starting_amount = 10000`

Run `python create_plot.py`. This will generate a plot using `matplotlib` and display it on the screen.

![Example Graph](https://i.imgur.com/5zrkEEm.png)


## Dependencies
To execute this code, you will need Python3, and the following Python modules: yfinance, matplotlib, datetime, pandas, and numpy. 

To install Python, visit [the Python website] (https://www.python.org/downloads/).

To install these modules, use the following commands:

`$ pip install yfinance matplotlib datetime pandas numpy`

## Descriptions

`create_plot.py`

This file contains the four parameters that the user has to change: the ticker, start date, end date, and starting amount. **This is the only file the user has to edit in order to use this tool.**

`buyopen_sellclose.py`

This file includes a function for this strategy that buys the stock at the start of trading hours and sells at the end of trading hours. It calculates the portofolio value at the end of the specified date range for the specific ticker and starting amount using this strategy.  

`buyclose_sellopen.py`

This file includes a function for this strategy that buys the stock at the end of trading hours and sells at the start of trading hours the next day. It calculates the portfolio value at the end of the specified date range for the specific ticker and starting amount using this strategy. 

`buy_and_hold.py`

This file includes a function for this strategy that buys the stock at the beginning of the date range and holds it until the end. It calculates the portfolio value at the end of the specified date range for the specific ticker and starting amount using this strategy. 

`fill_in_weekends.py`

When initially plotting the data, the x-axis labels were uneven and often had gaps where a date should have been. I created this file to add in any missing dates from the data set, such as weekends, holidays, or other dates when the stock market was closed. 


`x_axis_labels.py`

This file creates the x-axis labels for different date ranges. The first function, `def generate_x_axis_labels()`, creates labels based on how long the date range is. The second function, `def generate_evenly_spaced_x_axis_labels()` contains an alternative way of creating the labels but does not give uniform or "tidy-looking" dates on the x-axis. 

`plotter.py`

This file plots all the data generated by the following three files: `buyopen_sellclose.py`, `buyclose_sellopen.py`, and `buy_and_hold.py`. The portfolio values are on the y-axis and the dates are on the x-axis.  

`tests.py`

This file contains all the necessary tests to see if the code is working as expected. For each strategy, we test if the file returns a dictionary, and if it returns the expected value for the specified date range. I also tested to see if the file `fill_in_weekends.py` returns a dictionary with all missing dates filled in.
